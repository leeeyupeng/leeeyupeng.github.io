<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leeeyupeng.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="leeyupeng@126.com">
<meta property="og:type" content="website">
<meta property="og:title" content="leeyupeng">
<meta property="og:url" content="https://leeeyupeng.github.io/page/24/index.html">
<meta property="og:site_name" content="leeyupeng">
<meta property="og:description" content="leeyupeng@126.com">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="leeyupeng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://leeeyupeng.github.io/page/24/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>leeyupeng</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">leeyupeng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">leeyupeng@126.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-tagsalgorithm">

    <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95" rel="section"><i class="fa fa-book fa-fw"></i>数据结构与算法</a>

  </li>
        <li class="menu-item menu-item-tagscplusplus">

    <a href="/tags/C-C" rel="section"><i class="fa fa-book fa-fw"></i>C/C++</a>

  </li>
        <li class="menu-item menu-item-tagsgraphics">

    <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6" rel="section"><i class="fa fa-book fa-fw"></i>图形学</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html" class="post-title-link" itemprop="url">mini3d</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-16 13:05:25" itemprop="dateModified" datetime="2021-03-16T13:05:25+08:00">2021-03-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GameDev/" itemprop="url" rel="index"><span itemprop="name">GameDev</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GameDev/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/" itemprop="url" rel="index"><span itemprop="name">图形渲染</span></a>
                </span>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html" class="post-meta-item leancloud_visitors" data-flag-title="mini3d" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mini3d"><a href="#mini3d" class="headerlink" title="mini3d"></a>mini3d</h1><hr>
<p>大牛写的一个软渲染实现<br><a href="https://github.com/skywind3000/mini3d" target="_blank" rel="noopener">github</a>  </p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// mini3d.c - Mini Software Render All-In-One</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// build:</span></span><br><span class="line"><span class="comment">//   mingw: gcc -O3 mini3d.c -o mini3d.exe -lgdi32</span></span><br><span class="line"><span class="comment">//   msvc:  cl -O2 -nologo mini3d.c</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// history:</span></span><br><span class="line"><span class="comment">//   2007.7.01  skywind  create this file as a tutorial</span></span><br><span class="line"><span class="comment">//   2007.7.02  skywind  implementate texture and color render</span></span><br><span class="line"><span class="comment">//   2008.3.15  skywind  fixed a trapezoid issue</span></span><br><span class="line"><span class="comment">//   2015.8.09  skywind  rewrite with more comment</span></span><br><span class="line"><span class="comment">//   2015.8.12  skywind  adjust interfaces for clearity</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> IUINT32;</span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 数学库：此部分应该不用详解，熟悉 D3D 矩阵变换即可</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">float</span> m[<span class="number">4</span>][<span class="number">4</span>]; &#125; <span class="keyword">matrix_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">float</span> x, y, z, w; &#125; <span class="keyword">vector_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">vector_t</span> <span class="keyword">point_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CMID</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> <span class="built_in">min</span>, <span class="keyword">int</span> <span class="built_in">max</span>)</span> </span>&#123; <span class="keyword">return</span> (x &lt; <span class="built_in">min</span>)? <span class="built_in">min</span> : ((x &gt; <span class="built_in">max</span>)? <span class="built_in">max</span> : x); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算插值：t 为 [0, 1] 之间的数值</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">interp</span><span class="params">(<span class="keyword">float</span> x1, <span class="keyword">float</span> x2, <span class="keyword">float</span> t)</span> </span>&#123; <span class="keyword">return</span> x1 + (x2 - x1) * t; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// | v |</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">vector_length</span><span class="params">(<span class="keyword">const</span> <span class="keyword">vector_t</span> *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> sq = v-&gt;x * v-&gt;x + v-&gt;y * v-&gt;y + v-&gt;z * v-&gt;z;</span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">float</span>)<span class="built_in">sqrt</span>(sq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// z = x + y</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_add</span><span class="params">(<span class="keyword">vector_t</span> *z, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x, <span class="keyword">const</span> <span class="keyword">vector_t</span> *y)</span> </span>&#123;</span><br><span class="line">	z-&gt;x = x-&gt;x + y-&gt;x;</span><br><span class="line">	z-&gt;y = x-&gt;y + y-&gt;y;</span><br><span class="line">	z-&gt;z = x-&gt;z + y-&gt;z;</span><br><span class="line">	z-&gt;w = <span class="number">1.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// z = x - y</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_sub</span><span class="params">(<span class="keyword">vector_t</span> *z, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x, <span class="keyword">const</span> <span class="keyword">vector_t</span> *y)</span> </span>&#123;</span><br><span class="line">	z-&gt;x = x-&gt;x - y-&gt;x;</span><br><span class="line">	z-&gt;y = x-&gt;y - y-&gt;y;</span><br><span class="line">	z-&gt;z = x-&gt;z - y-&gt;z;</span><br><span class="line">	z-&gt;w = <span class="number">1.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矢量点乘</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">vector_dotproduct</span><span class="params">(<span class="keyword">const</span> <span class="keyword">vector_t</span> *x, <span class="keyword">const</span> <span class="keyword">vector_t</span> *y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x-&gt;x * y-&gt;x + x-&gt;y * y-&gt;y + x-&gt;z * y-&gt;z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矢量叉乘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_crossproduct</span><span class="params">(<span class="keyword">vector_t</span> *z, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x, <span class="keyword">const</span> <span class="keyword">vector_t</span> *y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> m1, m2, m3;</span><br><span class="line">	m1 = x-&gt;y * y-&gt;z - x-&gt;z * y-&gt;y;</span><br><span class="line">	m2 = x-&gt;z * y-&gt;x - x-&gt;x * y-&gt;z;</span><br><span class="line">	m3 = x-&gt;x * y-&gt;y - x-&gt;y * y-&gt;x;</span><br><span class="line">	z-&gt;x = m1;</span><br><span class="line">	z-&gt;y = m2;</span><br><span class="line">	z-&gt;z = m3;</span><br><span class="line">	z-&gt;w = <span class="number">1.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矢量插值，t取值 [0, 1]</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_interp</span><span class="params">(<span class="keyword">vector_t</span> *z, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x1, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x2, <span class="keyword">float</span> t)</span> </span>&#123;</span><br><span class="line">	z-&gt;x = interp(x1-&gt;x, x2-&gt;x, t);</span><br><span class="line">	z-&gt;y = interp(x1-&gt;y, x2-&gt;y, t);</span><br><span class="line">	z-&gt;z = interp(x1-&gt;z, x2-&gt;z, t);</span><br><span class="line">	z-&gt;w = <span class="number">1.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矢量归一化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_normalize</span><span class="params">(<span class="keyword">vector_t</span> *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> length = vector_length(v);</span><br><span class="line">	<span class="keyword">if</span> (length != <span class="number">0.0f</span>) &#123;</span><br><span class="line">		<span class="keyword">float</span> inv = <span class="number">1.0f</span> / length;</span><br><span class="line">		v-&gt;x *= inv;</span><br><span class="line">		v-&gt;y *= inv;</span><br><span class="line">		v-&gt;z *= inv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c = a + b</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_add</span><span class="params">(<span class="keyword">matrix_t</span> *c, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *a, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			c-&gt;m[i][j] = a-&gt;m[i][j] + b-&gt;m[i][j];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c = a - b</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_sub</span><span class="params">(<span class="keyword">matrix_t</span> *c, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *a, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			c-&gt;m[i][j] = a-&gt;m[i][j] - b-&gt;m[i][j];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c = a * b</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_mul</span><span class="params">(<span class="keyword">matrix_t</span> *c, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *a, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">matrix_t</span> z;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			z.m[j][i] = (a-&gt;m[j][<span class="number">0</span>] * b-&gt;m[<span class="number">0</span>][i]) +</span><br><span class="line">						(a-&gt;m[j][<span class="number">1</span>] * b-&gt;m[<span class="number">1</span>][i]) +</span><br><span class="line">						(a-&gt;m[j][<span class="number">2</span>] * b-&gt;m[<span class="number">2</span>][i]) +</span><br><span class="line">						(a-&gt;m[j][<span class="number">3</span>] * b-&gt;m[<span class="number">3</span>][i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	c[<span class="number">0</span>] = z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c = a * f</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_scale</span><span class="params">(<span class="keyword">matrix_t</span> *c, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *a, <span class="keyword">float</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			c-&gt;m[i][j] = a-&gt;m[i][j] * f;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// y = x * m</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_apply</span><span class="params">(<span class="keyword">vector_t</span> *y, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x, <span class="keyword">const</span> <span class="keyword">matrix_t</span> *m)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> X = x-&gt;x, Y = x-&gt;y, Z = x-&gt;z, W = x-&gt;w;</span><br><span class="line">	y-&gt;x = X * m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] + Y * m-&gt;m[<span class="number">1</span>][<span class="number">0</span>] + Z * m-&gt;m[<span class="number">2</span>][<span class="number">0</span>] + W * m-&gt;m[<span class="number">3</span>][<span class="number">0</span>];</span><br><span class="line">	y-&gt;y = X * m-&gt;m[<span class="number">0</span>][<span class="number">1</span>] + Y * m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] + Z * m-&gt;m[<span class="number">2</span>][<span class="number">1</span>] + W * m-&gt;m[<span class="number">3</span>][<span class="number">1</span>];</span><br><span class="line">	y-&gt;z = X * m-&gt;m[<span class="number">0</span>][<span class="number">2</span>] + Y * m-&gt;m[<span class="number">1</span>][<span class="number">2</span>] + Z * m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] + W * m-&gt;m[<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line">	y-&gt;w = X * m-&gt;m[<span class="number">0</span>][<span class="number">3</span>] + Y * m-&gt;m[<span class="number">1</span>][<span class="number">3</span>] + Z * m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] + W * m-&gt;m[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_identity</span><span class="params">(<span class="keyword">matrix_t</span> *m)</span> </span>&#123;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">3</span>] = <span class="number">1.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">0</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">0</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = <span class="number">0.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_zero</span><span class="params">(<span class="keyword">matrix_t</span> *m)</span> </span>&#123;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">0</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">0</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">0</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平移变换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_translate</span><span class="params">(<span class="keyword">matrix_t</span> *m, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z)</span> </span>&#123;</span><br><span class="line">	matrix_set_identity(m);</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">0</span>] = x;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">1</span>] = y;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缩放变换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_scale</span><span class="params">(<span class="keyword">matrix_t</span> *m, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z)</span> </span>&#123;</span><br><span class="line">	matrix_set_identity(m);</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = x;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = y;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_rotate</span><span class="params">(<span class="keyword">matrix_t</span> *m, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z, <span class="keyword">float</span> theta)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> qsin = (<span class="keyword">float</span>)<span class="built_in">sin</span>(theta * <span class="number">0.5f</span>);</span><br><span class="line">	<span class="keyword">float</span> qcos = (<span class="keyword">float</span>)<span class="built_in">cos</span>(theta * <span class="number">0.5f</span>);</span><br><span class="line">	<span class="keyword">vector_t</span> vec = &#123; x, y, z, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">float</span> w = qcos;</span><br><span class="line">	vector_normalize(&amp;vec);</span><br><span class="line">	x = vec.x * qsin;</span><br><span class="line">	y = vec.y * qsin;</span><br><span class="line">	z = vec.z * qsin;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> - <span class="number">2</span> * y * y - <span class="number">2</span> * z * z;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">2</span> * x * y - <span class="number">2</span> * w * z;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">2</span> * x * z + <span class="number">2</span> * w * y;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">2</span> * x * y + <span class="number">2</span> * w * z;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span> - <span class="number">2</span> * x * x - <span class="number">2</span> * z * z;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">1</span>] = <span class="number">2</span> * y * z - <span class="number">2</span> * w * x;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">2</span> * x * z - <span class="number">2</span> * w * y;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">2</span> * y * z + <span class="number">2</span> * w * x;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1</span> - <span class="number">2</span> * x * x - <span class="number">2</span> * y * y;</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">3</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">3</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">0</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">1</span>] = m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">3</span>] = <span class="number">1.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置摄像机</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_lookat</span><span class="params">(<span class="keyword">matrix_t</span> *m, <span class="keyword">const</span> <span class="keyword">vector_t</span> *eye, <span class="keyword">const</span> <span class="keyword">vector_t</span> *at, <span class="keyword">const</span> <span class="keyword">vector_t</span> *up)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">vector_t</span> xaxis, yaxis, zaxis;</span><br><span class="line"></span><br><span class="line">	vector_sub(&amp;zaxis, at, eye);</span><br><span class="line">	vector_normalize(&amp;zaxis);</span><br><span class="line">	vector_crossproduct(&amp;xaxis, up, &amp;zaxis);</span><br><span class="line">	vector_normalize(&amp;xaxis);</span><br><span class="line">	vector_crossproduct(&amp;yaxis, &amp;zaxis, &amp;xaxis);</span><br><span class="line"></span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = xaxis.x;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">0</span>] = xaxis.y;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">0</span>] = xaxis.z;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">0</span>] = -vector_dotproduct(&amp;xaxis, eye);</span><br><span class="line"></span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">1</span>] = yaxis.x;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = yaxis.y;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">1</span>] = yaxis.z;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">1</span>] = -vector_dotproduct(&amp;yaxis, eye);</span><br><span class="line"></span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">2</span>] = zaxis.x;</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">2</span>] = zaxis.y;</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = zaxis.z;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = -vector_dotproduct(&amp;zaxis, eye);</span><br><span class="line"></span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">3</span>] = m-&gt;m[<span class="number">1</span>][<span class="number">3</span>] = m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">3</span>] = <span class="number">1.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// D3DXMatrixPerspectiveFovLH</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrix_set_perspective</span><span class="params">(<span class="keyword">matrix_t</span> *m, <span class="keyword">float</span> fovy, <span class="keyword">float</span> aspect, <span class="keyword">float</span> zn, <span class="keyword">float</span> zf)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> fax = <span class="number">1.0f</span> / (<span class="keyword">float</span>)<span class="built_in">tan</span>(fovy * <span class="number">0.5f</span>);</span><br><span class="line">	matrix_set_zero(m);</span><br><span class="line">	m-&gt;m[<span class="number">0</span>][<span class="number">0</span>] = (<span class="keyword">float</span>)(fax / aspect);</span><br><span class="line">	m-&gt;m[<span class="number">1</span>][<span class="number">1</span>] = (<span class="keyword">float</span>)(fax);</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">2</span>] = zf / (zf - zn);</span><br><span class="line">	m-&gt;m[<span class="number">3</span>][<span class="number">2</span>] = - zn * zf / (zf - zn);</span><br><span class="line">	m-&gt;m[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 坐标变换</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">matrix_t</span> world;         <span class="comment">// 世界坐标变换</span></span><br><span class="line">	<span class="keyword">matrix_t</span> view;          <span class="comment">// 摄影机坐标变换</span></span><br><span class="line">	<span class="keyword">matrix_t</span> projection;    <span class="comment">// 投影变换</span></span><br><span class="line">	<span class="keyword">matrix_t</span> transform;     <span class="comment">// transform = world * view * projection</span></span><br><span class="line">	<span class="keyword">float</span> w, h;             <span class="comment">// 屏幕大小</span></span><br><span class="line">&#125;	<span class="keyword">transform_t</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 矩阵更新，计算 transform = world * view * projection</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_update</span><span class="params">(<span class="keyword">transform_t</span> *ts)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">matrix_t</span> m;</span><br><span class="line">	matrix_mul(&amp;m, &amp;ts-&gt;world, &amp;ts-&gt;view);</span><br><span class="line">	matrix_mul(&amp;ts-&gt;transform, &amp;m, &amp;ts-&gt;projection);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化，设置屏幕长宽</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_init</span><span class="params">(<span class="keyword">transform_t</span> *ts, <span class="keyword">int</span> <span class="built_in">width</span>, <span class="keyword">int</span> <span class="built_in">height</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> aspect = (<span class="keyword">float</span>)<span class="built_in">width</span> / ((<span class="keyword">float</span>)<span class="built_in">height</span>);</span><br><span class="line">	matrix_set_identity(&amp;ts-&gt;world);</span><br><span class="line">	matrix_set_identity(&amp;ts-&gt;view);</span><br><span class="line">	matrix_set_perspective(&amp;ts-&gt;projection, <span class="number">3.1415926f</span> * <span class="number">0.5f</span>, aspect, <span class="number">1.0f</span>, <span class="number">500.0f</span>);</span><br><span class="line">	ts-&gt;w = (<span class="keyword">float</span>)<span class="built_in">width</span>;</span><br><span class="line">	ts-&gt;h = (<span class="keyword">float</span>)<span class="built_in">height</span>;</span><br><span class="line">	transform_update(ts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将矢量 x 进行 project</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_apply</span><span class="params">(<span class="keyword">const</span> <span class="keyword">transform_t</span> *ts, <span class="keyword">vector_t</span> *y, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x)</span> </span>&#123;</span><br><span class="line">	matrix_apply(y, x, &amp;ts-&gt;transform);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查齐次坐标同 cvv 的边界用于视锥裁剪</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">transform_check_cvv</span><span class="params">(<span class="keyword">const</span> <span class="keyword">vector_t</span> *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> w = v-&gt;w;</span><br><span class="line">	<span class="keyword">int</span> check = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;z &lt; <span class="number">0.0f</span>) check |= <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;z &gt;  w) check |= <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;x &lt; -w) check |= <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;x &gt;  w) check |= <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;y &lt; -w) check |= <span class="number">16</span>;</span><br><span class="line">	<span class="keyword">if</span> (v-&gt;y &gt;  w) check |= <span class="number">32</span>;</span><br><span class="line">	<span class="keyword">return</span> check;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 归一化，得到屏幕坐标</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_homogenize</span><span class="params">(<span class="keyword">const</span> <span class="keyword">transform_t</span> *ts, <span class="keyword">vector_t</span> *y, <span class="keyword">const</span> <span class="keyword">vector_t</span> *x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> rhw = <span class="number">1.0f</span> / x-&gt;w;</span><br><span class="line">	y-&gt;x = (x-&gt;x * rhw + <span class="number">1.0f</span>) * ts-&gt;w * <span class="number">0.5f</span>;</span><br><span class="line">	y-&gt;y = (<span class="number">1.0f</span> - x-&gt;y * rhw) * ts-&gt;h * <span class="number">0.5f</span>;</span><br><span class="line">	y-&gt;z = x-&gt;z * rhw;</span><br><span class="line">	y-&gt;w = <span class="number">1.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 几何计算：顶点、扫描线、边缘、矩形、步长计算</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">float</span> r, g, b; &#125; <span class="keyword">color_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">float</span> u, v; &#125; <span class="keyword">texcoord_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">point_t</span> pos; <span class="keyword">texcoord_t</span> tc; <span class="keyword">color_t</span> color; <span class="keyword">float</span> rhw; &#125; <span class="keyword">vertex_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">vertex_t</span> v, v1, v2; &#125; <span class="keyword">edge_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">float</span> top, bottom; <span class="keyword">edge_t</span> left, right; &#125; <span class="keyword">trapezoid_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">vertex_t</span> v, <span class="built_in">step</span>; <span class="keyword">int</span> x, y, w; &#125; <span class="keyword">scanline_t</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vertex_rhw_init</span><span class="params">(<span class="keyword">vertex_t</span> *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> rhw = <span class="number">1.0f</span> / v-&gt;pos.w;</span><br><span class="line">	v-&gt;rhw = rhw;</span><br><span class="line">	v-&gt;tc.u *= rhw;</span><br><span class="line">	v-&gt;tc.v *= rhw;</span><br><span class="line">	v-&gt;color.r *= rhw;</span><br><span class="line">	v-&gt;color.g *= rhw;</span><br><span class="line">	v-&gt;color.b *= rhw;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vertex_interp</span><span class="params">(<span class="keyword">vertex_t</span> *y, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *x1, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *x2, <span class="keyword">float</span> t)</span> </span>&#123;</span><br><span class="line">	vector_interp(&amp;y-&gt;pos, &amp;x1-&gt;pos, &amp;x2-&gt;pos, t);</span><br><span class="line">	y-&gt;tc.u = interp(x1-&gt;tc.u, x2-&gt;tc.u, t);</span><br><span class="line">	y-&gt;tc.v = interp(x1-&gt;tc.v, x2-&gt;tc.v, t);</span><br><span class="line">	y-&gt;color.r = interp(x1-&gt;color.r, x2-&gt;color.r, t);</span><br><span class="line">	y-&gt;color.g = interp(x1-&gt;color.g, x2-&gt;color.g, t);</span><br><span class="line">	y-&gt;color.b = interp(x1-&gt;color.b, x2-&gt;color.b, t);</span><br><span class="line">	y-&gt;rhw = interp(x1-&gt;rhw, x2-&gt;rhw, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vertex_division</span><span class="params">(<span class="keyword">vertex_t</span> *y, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *x1, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *x2, <span class="keyword">float</span> w)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> inv = <span class="number">1.0f</span> / w;</span><br><span class="line">	y-&gt;pos.x = (x2-&gt;pos.x - x1-&gt;pos.x) * inv;</span><br><span class="line">	y-&gt;pos.y = (x2-&gt;pos.y - x1-&gt;pos.y) * inv;</span><br><span class="line">	y-&gt;pos.z = (x2-&gt;pos.z - x1-&gt;pos.z) * inv;</span><br><span class="line">	y-&gt;pos.w = (x2-&gt;pos.w - x1-&gt;pos.w) * inv;</span><br><span class="line">	y-&gt;tc.u = (x2-&gt;tc.u - x1-&gt;tc.u) * inv;</span><br><span class="line">	y-&gt;tc.v = (x2-&gt;tc.v - x1-&gt;tc.v) * inv;</span><br><span class="line">	y-&gt;color.r = (x2-&gt;color.r - x1-&gt;color.r) * inv;</span><br><span class="line">	y-&gt;color.g = (x2-&gt;color.g - x1-&gt;color.g) * inv;</span><br><span class="line">	y-&gt;color.b = (x2-&gt;color.b - x1-&gt;color.b) * inv;</span><br><span class="line">	y-&gt;rhw = (x2-&gt;rhw - x1-&gt;rhw) * inv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vertex_add</span><span class="params">(<span class="keyword">vertex_t</span> *y, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *x)</span> </span>&#123;</span><br><span class="line">	y-&gt;pos.x += x-&gt;pos.x;</span><br><span class="line">	y-&gt;pos.y += x-&gt;pos.y;</span><br><span class="line">	y-&gt;pos.z += x-&gt;pos.z;</span><br><span class="line">	y-&gt;pos.w += x-&gt;pos.w;</span><br><span class="line">	y-&gt;rhw += x-&gt;rhw;</span><br><span class="line">	y-&gt;tc.u += x-&gt;tc.u;</span><br><span class="line">	y-&gt;tc.v += x-&gt;tc.v;</span><br><span class="line">	y-&gt;color.r += x-&gt;color.r;</span><br><span class="line">	y-&gt;color.g += x-&gt;color.g;</span><br><span class="line">	y-&gt;color.b += x-&gt;color.b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据三角形生成 0-2 个梯形，并且返回合法梯形的数量</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">trapezoid_init_triangle</span><span class="params">(<span class="keyword">trapezoid_t</span> *trap, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *p1,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> <span class="keyword">vertex_t</span> *p2, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *p3)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">vertex_t</span> *p;</span><br><span class="line">	<span class="keyword">float</span> k, x;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p1-&gt;pos.y &gt; p2-&gt;pos.y) p = p1, p1 = p2, p2 = p;</span><br><span class="line">	<span class="keyword">if</span> (p1-&gt;pos.y &gt; p3-&gt;pos.y) p = p1, p1 = p3, p3 = p;</span><br><span class="line">	<span class="keyword">if</span> (p2-&gt;pos.y &gt; p3-&gt;pos.y) p = p2, p2 = p3, p3 = p;</span><br><span class="line">	<span class="keyword">if</span> (p1-&gt;pos.y == p2-&gt;pos.y &amp;&amp; p1-&gt;pos.y == p3-&gt;pos.y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (p1-&gt;pos.x == p2-&gt;pos.x &amp;&amp; p1-&gt;pos.x == p3-&gt;pos.x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p1-&gt;pos.y == p2-&gt;pos.y) &#123;	<span class="comment">// triangle down</span></span><br><span class="line">		<span class="keyword">if</span> (p1-&gt;pos.x &gt; p2-&gt;pos.x) p = p1, p1 = p2, p2 = p;</span><br><span class="line">		trap[<span class="number">0</span>].top = p1-&gt;pos.y;</span><br><span class="line">		trap[<span class="number">0</span>].bottom = p3-&gt;pos.y;</span><br><span class="line">		trap[<span class="number">0</span>].left.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].left.v2 = *p3;</span><br><span class="line">		trap[<span class="number">0</span>].right.v1 = *p2;</span><br><span class="line">		trap[<span class="number">0</span>].right.v2 = *p3;</span><br><span class="line">		<span class="keyword">return</span> (trap[<span class="number">0</span>].top &lt; trap[<span class="number">0</span>].bottom)? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p2-&gt;pos.y == p3-&gt;pos.y) &#123;	<span class="comment">// triangle up</span></span><br><span class="line">		<span class="keyword">if</span> (p2-&gt;pos.x &gt; p3-&gt;pos.x) p = p2, p2 = p3, p3 = p;</span><br><span class="line">		trap[<span class="number">0</span>].top = p1-&gt;pos.y;</span><br><span class="line">		trap[<span class="number">0</span>].bottom = p3-&gt;pos.y;</span><br><span class="line">		trap[<span class="number">0</span>].left.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].left.v2 = *p2;</span><br><span class="line">		trap[<span class="number">0</span>].right.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].right.v2 = *p3;</span><br><span class="line">		<span class="keyword">return</span> (trap[<span class="number">0</span>].top &lt; trap[<span class="number">0</span>].bottom)? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	trap[<span class="number">0</span>].top = p1-&gt;pos.y;</span><br><span class="line">	trap[<span class="number">0</span>].bottom = p2-&gt;pos.y;</span><br><span class="line">	trap[<span class="number">1</span>].top = p2-&gt;pos.y;</span><br><span class="line">	trap[<span class="number">1</span>].bottom = p3-&gt;pos.y;</span><br><span class="line"></span><br><span class="line">	k = (p3-&gt;pos.y - p1-&gt;pos.y) / (p2-&gt;pos.y - p1-&gt;pos.y);</span><br><span class="line">	x = p1-&gt;pos.x + (p2-&gt;pos.x - p1-&gt;pos.x) * k;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (x &lt;= p3-&gt;pos.x) &#123;		<span class="comment">// triangle left</span></span><br><span class="line">		trap[<span class="number">0</span>].left.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].left.v2 = *p2;</span><br><span class="line">		trap[<span class="number">0</span>].right.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].right.v2 = *p3;</span><br><span class="line">		trap[<span class="number">1</span>].left.v1 = *p2;</span><br><span class="line">		trap[<span class="number">1</span>].left.v2 = *p3;</span><br><span class="line">		trap[<span class="number">1</span>].right.v1 = *p1;</span><br><span class="line">		trap[<span class="number">1</span>].right.v2 = *p3;</span><br><span class="line">	&#125;	<span class="keyword">else</span> &#123;					<span class="comment">// triangle right</span></span><br><span class="line">		trap[<span class="number">0</span>].left.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].left.v2 = *p3;</span><br><span class="line">		trap[<span class="number">0</span>].right.v1 = *p1;</span><br><span class="line">		trap[<span class="number">0</span>].right.v2 = *p2;</span><br><span class="line">		trap[<span class="number">1</span>].left.v1 = *p1;</span><br><span class="line">		trap[<span class="number">1</span>].left.v2 = *p3;</span><br><span class="line">		trap[<span class="number">1</span>].right.v1 = *p2;</span><br><span class="line">		trap[<span class="number">1</span>].right.v2 = *p3;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按照 Y 坐标计算出左右两条边纵坐标等于 Y 的顶点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trapezoid_edge_interp</span><span class="params">(<span class="keyword">trapezoid_t</span> *trap, <span class="keyword">float</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> s1 = trap-&gt;left.v2.pos.y - trap-&gt;left.v1.pos.y;</span><br><span class="line">	<span class="keyword">float</span> s2 = trap-&gt;right.v2.pos.y - trap-&gt;right.v1.pos.y;</span><br><span class="line">	<span class="keyword">float</span> t1 = (y - trap-&gt;left.v1.pos.y) / s1;</span><br><span class="line">	<span class="keyword">float</span> t2 = (y - trap-&gt;right.v1.pos.y) / s2;</span><br><span class="line">	vertex_interp(&amp;trap-&gt;left.v, &amp;trap-&gt;left.v1, &amp;trap-&gt;left.v2, t1);</span><br><span class="line">	vertex_interp(&amp;trap-&gt;right.v, &amp;trap-&gt;right.v1, &amp;trap-&gt;right.v2, t2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据左右两边的端点，初始化计算出扫描线的起点和步长</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trapezoid_init_scan_line</span><span class="params">(<span class="keyword">const</span> <span class="keyword">trapezoid_t</span> *trap, <span class="keyword">scanline_t</span> *scanline, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span> <span class="built_in">width</span> = trap-&gt;right.v.pos.x - trap-&gt;left.v.pos.x;</span><br><span class="line">	scanline-&gt;x = (<span class="keyword">int</span>)(trap-&gt;left.v.pos.x + <span class="number">0.5f</span>);</span><br><span class="line">	scanline-&gt;w = (<span class="keyword">int</span>)(trap-&gt;right.v.pos.x + <span class="number">0.5f</span>) - scanline-&gt;x;</span><br><span class="line">	scanline-&gt;y = y;</span><br><span class="line">	scanline-&gt;v = trap-&gt;left.v;</span><br><span class="line">	<span class="keyword">if</span> (trap-&gt;left.v.pos.x &gt;= trap-&gt;right.v.pos.x) scanline-&gt;w = <span class="number">0</span>;</span><br><span class="line">	vertex_division(&amp;scanline-&gt;<span class="built_in">step</span>, &amp;trap-&gt;left.v, &amp;trap-&gt;right.v, <span class="built_in">width</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 渲染设备</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">transform_t</span> transform;      <span class="comment">// 坐标变换器</span></span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">width</span>;                  <span class="comment">// 窗口宽度</span></span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">height</span>;                 <span class="comment">// 窗口高度</span></span><br><span class="line">	IUINT32 **framebuffer;      <span class="comment">// 像素缓存：framebuffer[y] 代表第 y行</span></span><br><span class="line">	<span class="keyword">float</span> **zbuffer;            <span class="comment">// 深度缓存：zbuffer[y] 为第 y行指针</span></span><br><span class="line">	IUINT32 **texture;          <span class="comment">// 纹理：同样是每行索引</span></span><br><span class="line">	<span class="keyword">int</span> tex_width;              <span class="comment">// 纹理宽度</span></span><br><span class="line">	<span class="keyword">int</span> tex_height;             <span class="comment">// 纹理高度</span></span><br><span class="line">	<span class="keyword">float</span> max_u;                <span class="comment">// 纹理最大宽度：tex_width - 1</span></span><br><span class="line">	<span class="keyword">float</span> max_v;                <span class="comment">// 纹理最大高度：tex_height - 1</span></span><br><span class="line">	<span class="keyword">int</span> render_state;           <span class="comment">// 渲染状态</span></span><br><span class="line">	IUINT32 <span class="built_in">background</span>;         <span class="comment">// 背景颜色</span></span><br><span class="line">	IUINT32 foreground;         <span class="comment">// 线框颜色</span></span><br><span class="line">&#125;	<span class="keyword">device_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RENDER_STATE_WIREFRAME      1		<span class="comment">// 渲染线框</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RENDER_STATE_TEXTURE        2		<span class="comment">// 渲染纹理</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RENDER_STATE_COLOR          4		<span class="comment">// 渲染颜色</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设备初始化，fb为外部帧缓存，非 NULL 将引用外部帧缓存（每行 4字节对齐）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_init</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">int</span> <span class="built_in">width</span>, <span class="keyword">int</span> <span class="built_in">height</span>, <span class="keyword">void</span> *fb)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> need = <span class="keyword">sizeof</span>(<span class="keyword">void</span>*) * (<span class="built_in">height</span> * <span class="number">2</span> + <span class="number">1024</span>) + <span class="built_in">width</span> * <span class="built_in">height</span> * <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">char</span> *ptr = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(need + <span class="number">64</span>);</span><br><span class="line">	<span class="keyword">char</span> *framebuf, *zbuf;</span><br><span class="line">	<span class="keyword">int</span> j;</span><br><span class="line">	assert(ptr);</span><br><span class="line">	device-&gt;framebuffer = (IUINT32**)ptr;</span><br><span class="line">	device-&gt;zbuffer = (<span class="keyword">float</span>**)(ptr + <span class="keyword">sizeof</span>(<span class="keyword">void</span>*) * <span class="built_in">height</span>);</span><br><span class="line">	ptr += <span class="keyword">sizeof</span>(<span class="keyword">void</span>*) * <span class="built_in">height</span> * <span class="number">2</span>;</span><br><span class="line">	device-&gt;texture = (IUINT32**)ptr;</span><br><span class="line">	ptr += <span class="keyword">sizeof</span>(<span class="keyword">void</span>*) * <span class="number">1024</span>;</span><br><span class="line">	framebuf = (<span class="keyword">char</span>*)ptr;</span><br><span class="line">	zbuf = (<span class="keyword">char</span>*)ptr + <span class="built_in">width</span> * <span class="built_in">height</span> * <span class="number">4</span>;</span><br><span class="line">	ptr += <span class="built_in">width</span> * <span class="built_in">height</span> * <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">if</span> (fb != <span class="literal">NULL</span>) framebuf = (<span class="keyword">char</span>*)fb;</span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="built_in">height</span>; j++) &#123;</span><br><span class="line">		device-&gt;framebuffer[j] = (IUINT32*)(framebuf + <span class="built_in">width</span> * <span class="number">4</span> * j);</span><br><span class="line">		device-&gt;zbuffer[j] = (<span class="keyword">float</span>*)(zbuf + <span class="built_in">width</span> * <span class="number">4</span> * j);</span><br><span class="line">	&#125;</span><br><span class="line">	device-&gt;texture[<span class="number">0</span>] = (IUINT32*)ptr;</span><br><span class="line">	device-&gt;texture[<span class="number">1</span>] = (IUINT32*)(ptr + <span class="number">16</span>);</span><br><span class="line">	<span class="built_in">memset</span>(device-&gt;texture[<span class="number">0</span>], <span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line">	device-&gt;tex_width = <span class="number">2</span>;</span><br><span class="line">	device-&gt;tex_height = <span class="number">2</span>;</span><br><span class="line">	device-&gt;max_u = <span class="number">1.0f</span>;</span><br><span class="line">	device-&gt;max_v = <span class="number">1.0f</span>;</span><br><span class="line">	device-&gt;<span class="built_in">width</span> = <span class="built_in">width</span>;</span><br><span class="line">	device-&gt;<span class="built_in">height</span> = <span class="built_in">height</span>;</span><br><span class="line">	device-&gt;<span class="built_in">background</span> = <span class="number">0xc0c0c0</span>;</span><br><span class="line">	device-&gt;foreground = <span class="number">0</span>;</span><br><span class="line">	transform_init(&amp;device-&gt;transform, <span class="built_in">width</span>, <span class="built_in">height</span>);</span><br><span class="line">	device-&gt;render_state = RENDER_STATE_WIREFRAME;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除设备</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_destroy</span><span class="params">(<span class="keyword">device_t</span> *device)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (device-&gt;framebuffer)</span><br><span class="line">		<span class="built_in">free</span>(device-&gt;framebuffer);</span><br><span class="line">	device-&gt;framebuffer = <span class="literal">NULL</span>;</span><br><span class="line">	device-&gt;zbuffer = <span class="literal">NULL</span>;</span><br><span class="line">	device-&gt;texture = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置当前纹理</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_set_texture</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">void</span> *bits, <span class="keyword">long</span> pitch, <span class="keyword">int</span> w, <span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *ptr = (<span class="keyword">char</span>*)bits;</span><br><span class="line">	<span class="keyword">int</span> j;</span><br><span class="line">	assert(w &lt;= <span class="number">1024</span> &amp;&amp; h &lt;= <span class="number">1024</span>);</span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; h; ptr += pitch, j++) 	<span class="comment">// 重新计算每行纹理的指针</span></span><br><span class="line">		device-&gt;texture[j] = (IUINT32*)ptr;</span><br><span class="line">	device-&gt;tex_width = w;</span><br><span class="line">	device-&gt;tex_height = h;</span><br><span class="line">	device-&gt;max_u = (<span class="keyword">float</span>)(w - <span class="number">1</span>);</span><br><span class="line">	device-&gt;max_v = (<span class="keyword">float</span>)(h - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空 framebuffer 和 zbuffer</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_clear</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">int</span> mode)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> y, x, <span class="built_in">height</span> = device-&gt;<span class="built_in">height</span>;</span><br><span class="line">	<span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; device-&gt;<span class="built_in">height</span>; y++) &#123;</span><br><span class="line">		IUINT32 *dst = device-&gt;framebuffer[y];</span><br><span class="line">		IUINT32 cc = (<span class="built_in">height</span> - <span class="number">1</span> - y) * <span class="number">230</span> / (<span class="built_in">height</span> - <span class="number">1</span>);</span><br><span class="line">		cc = (cc &lt;&lt; <span class="number">16</span>) | (cc &lt;&lt; <span class="number">8</span>) | cc;</span><br><span class="line">		<span class="keyword">if</span> (mode == <span class="number">0</span>) cc = device-&gt;<span class="built_in">background</span>;</span><br><span class="line">		<span class="keyword">for</span> (x = device-&gt;<span class="built_in">width</span>; x &gt; <span class="number">0</span>; dst++, x--) dst[<span class="number">0</span>] = cc;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; device-&gt;<span class="built_in">height</span>; y++) &#123;</span><br><span class="line">		<span class="keyword">float</span> *dst = device-&gt;zbuffer[y];</span><br><span class="line">		<span class="keyword">for</span> (x = device-&gt;<span class="built_in">width</span>; x &gt; <span class="number">0</span>; dst++, x--) dst[<span class="number">0</span>] = <span class="number">0.0f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 画点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_pixel</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">int</span> x, <span class="keyword">int</span> y, IUINT32 color)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (((IUINT32)x) &lt; (IUINT32)device-&gt;<span class="built_in">width</span> &amp;&amp; ((IUINT32)y) &lt; (IUINT32)device-&gt;<span class="built_in">height</span>) &#123;</span><br><span class="line">		device-&gt;framebuffer[y][x] = color;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制线段</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_draw_line</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2, IUINT32 c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> x, y, rem = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (x1 == x2 &amp;&amp; y1 == y2) &#123;</span><br><span class="line">		device_pixel(device, x1, y1, c);</span><br><span class="line">	&#125;	<span class="keyword">else</span> <span class="keyword">if</span> (x1 == x2) &#123;</span><br><span class="line">		<span class="keyword">int</span> inc = (y1 &lt;= y2)? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span> (y = y1; y != y2; y += inc) device_pixel(device, x1, y, c);</span><br><span class="line">		device_pixel(device, x2, y2, c);</span><br><span class="line">	&#125;	<span class="keyword">else</span> <span class="keyword">if</span> (y1 == y2) &#123;</span><br><span class="line">		<span class="keyword">int</span> inc = (x1 &lt;= x2)? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span> (x = x1; x != x2; x += inc) device_pixel(device, x, y1, c);</span><br><span class="line">		device_pixel(device, x2, y2, c);</span><br><span class="line">	&#125;	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> dx = (x1 &lt; x2)? x2 - x1 : x1 - x2;</span><br><span class="line">		<span class="keyword">int</span> dy = (y1 &lt; y2)? y2 - y1 : y1 - y2;</span><br><span class="line">		<span class="keyword">if</span> (dx &gt;= dy) &#123;</span><br><span class="line">			<span class="keyword">if</span> (x2 &lt; x1) x = x1, y = y1, x1 = x2, y1 = y2, x2 = x, y2 = y;</span><br><span class="line">			<span class="keyword">for</span> (x = x1, y = y1; x &lt;= x2; x++) &#123;</span><br><span class="line">				device_pixel(device, x, y, c);</span><br><span class="line">				rem += dy;</span><br><span class="line">				<span class="keyword">if</span> (rem &gt;= dx) &#123;</span><br><span class="line">					rem -= dx;</span><br><span class="line">					y += (y2 &gt;= y1)? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">					device_pixel(device, x, y, c);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			device_pixel(device, x2, y2, c);</span><br><span class="line">		&#125;	<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (y2 &lt; y1) x = x1, y = y1, x1 = x2, y1 = y2, x2 = x, y2 = y;</span><br><span class="line">			<span class="keyword">for</span> (x = x1, y = y1; y &lt;= y2; y++) &#123;</span><br><span class="line">				device_pixel(device, x, y, c);</span><br><span class="line">				rem += dx;</span><br><span class="line">				<span class="keyword">if</span> (rem &gt;= dy) &#123;</span><br><span class="line">					rem -= dy;</span><br><span class="line">					x += (x2 &gt;= x1)? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">					device_pixel(device, x, y, c);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			device_pixel(device, x2, y2, c);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据坐标读取纹理</span></span><br><span class="line"><span class="function">IUINT32 <span class="title">device_texture_read</span><span class="params">(<span class="keyword">const</span> <span class="keyword">device_t</span> *device, <span class="keyword">float</span> u, <span class="keyword">float</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> x, y;</span><br><span class="line">	u = u * device-&gt;max_u;</span><br><span class="line">	v = v * device-&gt;max_v;</span><br><span class="line">	x = (<span class="keyword">int</span>)(u + <span class="number">0.5f</span>);</span><br><span class="line">	y = (<span class="keyword">int</span>)(v + <span class="number">0.5f</span>);</span><br><span class="line">	x = CMID(x, <span class="number">0</span>, device-&gt;tex_width - <span class="number">1</span>);</span><br><span class="line">	y = CMID(y, <span class="number">0</span>, device-&gt;tex_height - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> device-&gt;texture[y][x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 渲染实现</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制扫描线</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_draw_scanline</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">scanline_t</span> *scanline)</span> </span>&#123;</span><br><span class="line">	IUINT32 *framebuffer = device-&gt;framebuffer[scanline-&gt;y];</span><br><span class="line">	<span class="keyword">float</span> *zbuffer = device-&gt;zbuffer[scanline-&gt;y];</span><br><span class="line">	<span class="keyword">int</span> x = scanline-&gt;x;</span><br><span class="line">	<span class="keyword">int</span> w = scanline-&gt;w;</span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">width</span> = device-&gt;<span class="built_in">width</span>;</span><br><span class="line">	<span class="keyword">int</span> render_state = device-&gt;render_state;</span><br><span class="line">	<span class="keyword">for</span> (; w &gt; <span class="number">0</span>; x++, w--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (x &gt;= <span class="number">0</span> &amp;&amp; x &lt; <span class="built_in">width</span>) &#123;</span><br><span class="line">			<span class="keyword">float</span> rhw = scanline-&gt;v.rhw;</span><br><span class="line">			<span class="keyword">if</span> (rhw &gt;= zbuffer[x]) &#123;</span><br><span class="line">				<span class="keyword">float</span> w = <span class="number">1.0f</span> / rhw;</span><br><span class="line">				zbuffer[x] = rhw;</span><br><span class="line">				<span class="keyword">if</span> (render_state &amp; RENDER_STATE_COLOR) &#123;</span><br><span class="line">					<span class="keyword">float</span> r = scanline-&gt;v.color.r * w;</span><br><span class="line">					<span class="keyword">float</span> g = scanline-&gt;v.color.g * w;</span><br><span class="line">					<span class="keyword">float</span> b = scanline-&gt;v.color.b * w;</span><br><span class="line">					<span class="keyword">int</span> R = (<span class="keyword">int</span>)(r * <span class="number">255.0f</span>);</span><br><span class="line">					<span class="keyword">int</span> G = (<span class="keyword">int</span>)(g * <span class="number">255.0f</span>);</span><br><span class="line">					<span class="keyword">int</span> B = (<span class="keyword">int</span>)(b * <span class="number">255.0f</span>);</span><br><span class="line">					R = CMID(R, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">					G = CMID(G, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">					B = CMID(B, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">					framebuffer[x] = (R &lt;&lt; <span class="number">16</span>) | (G &lt;&lt; <span class="number">8</span>) | (B);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (render_state &amp; RENDER_STATE_TEXTURE) &#123;</span><br><span class="line">					<span class="keyword">float</span> u = scanline-&gt;v.tc.u * w;</span><br><span class="line">					<span class="keyword">float</span> v = scanline-&gt;v.tc.v * w;</span><br><span class="line">					IUINT32 cc = device_texture_read(device, u, v);</span><br><span class="line">					framebuffer[x] = cc;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		vertex_add(&amp;scanline-&gt;v, &amp;scanline-&gt;<span class="built_in">step</span>);</span><br><span class="line">		<span class="keyword">if</span> (x &gt;= <span class="built_in">width</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主渲染函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_render_trap</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">trapezoid_t</span> *trap)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">scanline_t</span> scanline;</span><br><span class="line">	<span class="keyword">int</span> j, top, bottom;</span><br><span class="line">	top = (<span class="keyword">int</span>)(trap-&gt;top + <span class="number">0.5f</span>);</span><br><span class="line">	bottom = (<span class="keyword">int</span>)(trap-&gt;bottom + <span class="number">0.5f</span>);</span><br><span class="line">	<span class="keyword">for</span> (j = top; j &lt; bottom; j++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (j &gt;= <span class="number">0</span> &amp;&amp; j &lt; device-&gt;<span class="built_in">height</span>) &#123;</span><br><span class="line">			trapezoid_edge_interp(trap, (<span class="keyword">float</span>)j + <span class="number">0.5f</span>);</span><br><span class="line">			trapezoid_init_scan_line(trap, &amp;scanline, j);</span><br><span class="line">			device_draw_scanline(device, &amp;scanline);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (j &gt;= device-&gt;<span class="built_in">height</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 render_state 绘制原始三角形</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">device_draw_primitive</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *v1,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> <span class="keyword">vertex_t</span> *v2, <span class="keyword">const</span> <span class="keyword">vertex_t</span> *v3)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">point_t</span> p1, p2, p3, c1, c2, c3;</span><br><span class="line">	<span class="keyword">int</span> render_state = device-&gt;render_state;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 按照 Transform 变化</span></span><br><span class="line">	transform_apply(&amp;device-&gt;transform, &amp;c1, &amp;v1-&gt;pos);</span><br><span class="line">	transform_apply(&amp;device-&gt;transform, &amp;c2, &amp;v2-&gt;pos);</span><br><span class="line">	transform_apply(&amp;device-&gt;transform, &amp;c3, &amp;v3-&gt;pos);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 裁剪，注意此处可以完善为具体判断几个点在 cvv内以及同cvv相交平面的坐标比例</span></span><br><span class="line">	<span class="comment">// 进行进一步精细裁剪，将一个分解为几个完全处在 cvv内的三角形</span></span><br><span class="line">	<span class="keyword">if</span> (transform_check_cvv(&amp;c1) != <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (transform_check_cvv(&amp;c2) != <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (transform_check_cvv(&amp;c3) != <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 归一化</span></span><br><span class="line">	transform_homogenize(&amp;device-&gt;transform, &amp;p1, &amp;c1);</span><br><span class="line">	transform_homogenize(&amp;device-&gt;transform, &amp;p2, &amp;c2);</span><br><span class="line">	transform_homogenize(&amp;device-&gt;transform, &amp;p3, &amp;c3);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 纹理或者色彩绘制</span></span><br><span class="line">	<span class="keyword">if</span> (render_state &amp; (RENDER_STATE_TEXTURE | RENDER_STATE_COLOR)) &#123;</span><br><span class="line">		<span class="keyword">vertex_t</span> t1 = *v1, t2 = *v2, t3 = *v3;</span><br><span class="line">		<span class="keyword">trapezoid_t</span> traps[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">		t1.pos = p1;</span><br><span class="line">		t2.pos = p2;</span><br><span class="line">		t3.pos = p3;</span><br><span class="line">		t1.pos.w = c1.w;</span><br><span class="line">		t2.pos.w = c2.w;</span><br><span class="line">		t3.pos.w = c3.w;</span><br><span class="line"></span><br><span class="line">		vertex_rhw_init(&amp;t1);	<span class="comment">// 初始化 w</span></span><br><span class="line">		vertex_rhw_init(&amp;t2);	<span class="comment">// 初始化 w</span></span><br><span class="line">		vertex_rhw_init(&amp;t3);	<span class="comment">// 初始化 w</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 拆分三角形为0-2个梯形，并且返回可用梯形数量</span></span><br><span class="line">		n = trapezoid_init_triangle(traps, &amp;t1, &amp;t2, &amp;t3);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (n &gt;= <span class="number">1</span>) device_render_trap(device, &amp;traps[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">if</span> (n &gt;= <span class="number">2</span>) device_render_trap(device, &amp;traps[<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (render_state &amp; RENDER_STATE_WIREFRAME) &#123;		<span class="comment">// 线框绘制</span></span><br><span class="line">		device_draw_line(device, (<span class="keyword">int</span>)p1.x, (<span class="keyword">int</span>)p1.y, (<span class="keyword">int</span>)p2.x, (<span class="keyword">int</span>)p2.y, device-&gt;foreground);</span><br><span class="line">		device_draw_line(device, (<span class="keyword">int</span>)p1.x, (<span class="keyword">int</span>)p1.y, (<span class="keyword">int</span>)p3.x, (<span class="keyword">int</span>)p3.y, device-&gt;foreground);</span><br><span class="line">		device_draw_line(device, (<span class="keyword">int</span>)p3.x, (<span class="keyword">int</span>)p3.y, (<span class="keyword">int</span>)p2.x, (<span class="keyword">int</span>)p2.y, device-&gt;foreground);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// Win32 窗口及图形绘制：为 device 提供一个 DibSection 的 FB</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">int</span> screen_w, screen_h, screen_exit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> screen_mx = <span class="number">0</span>, screen_my = <span class="number">0</span>, screen_mb = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> screen_keys[<span class="number">512</span>];	<span class="comment">// 当前键盘按下状态</span></span><br><span class="line"><span class="keyword">static</span> HWND screen_handle = <span class="literal">NULL</span>;		<span class="comment">// 主窗口 HWND</span></span><br><span class="line"><span class="keyword">static</span> HDC screen_dc = <span class="literal">NULL</span>;			<span class="comment">// 配套的 HDC</span></span><br><span class="line"><span class="keyword">static</span> HBITMAP screen_hb = <span class="literal">NULL</span>;		<span class="comment">// DIB</span></span><br><span class="line"><span class="keyword">static</span> HBITMAP screen_ob = <span class="literal">NULL</span>;		<span class="comment">// 老的 BITMAP</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *screen_fb = <span class="literal">NULL</span>;		<span class="comment">// frame buffer</span></span><br><span class="line"><span class="keyword">long</span> screen_pitch = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">screen_init</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">const</span> TCHAR *title)</span></span>;	<span class="comment">// 屏幕初始化</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">screen_close</span><span class="params">(<span class="keyword">void</span>)</span></span>;								<span class="comment">// 关闭屏幕</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">screen_dispatch</span><span class="params">(<span class="keyword">void</span>)</span></span>;							<span class="comment">// 处理消息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">screen_update</span><span class="params">(<span class="keyword">void</span>)</span></span>;							<span class="comment">// 显示 FrameBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// win32 event handler</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> LRESULT <span class="title">screen_events</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _MSC_VER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"gdi32.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"user32.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化窗口并设置标题</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">screen_init</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">const</span> TCHAR *title)</span> </span>&#123;</span><br><span class="line">	WNDCLASS wc = &#123; CS_BYTEALIGNCLIENT, (WNDPROC)screen_events, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		<span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, _T(<span class="string">"SCREEN3.1415926"</span>) &#125;;</span><br><span class="line">	BITMAPINFO bi = &#123; &#123; <span class="keyword">sizeof</span>(BITMAPINFOHEADER), w, -h, <span class="number">1</span>, <span class="number">32</span>, BI_RGB,</span><br><span class="line">		w * h * <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;  &#125;;</span><br><span class="line">	RECT <span class="built_in">rect</span> = &#123; <span class="number">0</span>, <span class="number">0</span>, w, h &#125;;</span><br><span class="line">	<span class="keyword">int</span> wx, wy, sx, sy;</span><br><span class="line">	LPVOID ptr;</span><br><span class="line">	HDC hDC;</span><br><span class="line"></span><br><span class="line">	screen_close();</span><br><span class="line"></span><br><span class="line">	wc.hbrBackground = (HBRUSH)GetStockObject(BLACK_BRUSH);</span><br><span class="line">	wc.hInstance = GetModuleHandle(<span class="literal">NULL</span>);</span><br><span class="line">	wc.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);</span><br><span class="line">	<span class="keyword">if</span> (!RegisterClass(&amp;wc)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	screen_handle = CreateWindow(_T(<span class="string">"SCREEN3.1415926"</span>), title,</span><br><span class="line">		WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, wc.hInstance, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (screen_handle == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line"></span><br><span class="line">	screen_exit = <span class="number">0</span>;</span><br><span class="line">	hDC = GetDC(screen_handle);</span><br><span class="line">	screen_dc = CreateCompatibleDC(hDC);</span><br><span class="line">	ReleaseDC(screen_handle, hDC);</span><br><span class="line"></span><br><span class="line">	screen_hb = CreateDIBSection(screen_dc, &amp;bi, DIB_RGB_COLORS, &amp;ptr, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (screen_hb == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line"></span><br><span class="line">	screen_ob = (HBITMAP)SelectObject(screen_dc, screen_hb);</span><br><span class="line">	screen_fb = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ptr;</span><br><span class="line">	screen_w = w;</span><br><span class="line">	screen_h = h;</span><br><span class="line">	screen_pitch = w * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	AdjustWindowRect(&amp;<span class="built_in">rect</span>, GetWindowLong(screen_handle, GWL_STYLE), <span class="number">0</span>);</span><br><span class="line">	wx = <span class="built_in">rect</span>.right - <span class="built_in">rect</span>.left;</span><br><span class="line">	wy = <span class="built_in">rect</span>.bottom - <span class="built_in">rect</span>.top;</span><br><span class="line">	sx = (GetSystemMetrics(SM_CXSCREEN) - wx) / <span class="number">2</span>;</span><br><span class="line">	sy = (GetSystemMetrics(SM_CYSCREEN) - wy) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">if</span> (sy &lt; <span class="number">0</span>) sy = <span class="number">0</span>;</span><br><span class="line">	SetWindowPos(screen_handle, <span class="literal">NULL</span>, sx, sy, wx, wy, (SWP_NOCOPYBITS | SWP_NOZORDER | SWP_SHOWWINDOW));</span><br><span class="line">	SetForegroundWindow(screen_handle);</span><br><span class="line"></span><br><span class="line">	ShowWindow(screen_handle, SW_NORMAL);</span><br><span class="line">	screen_dispatch();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(screen_keys, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * <span class="number">512</span>);</span><br><span class="line">	<span class="built_in">memset</span>(screen_fb, <span class="number">0</span>, w * h * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">screen_close</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (screen_dc) &#123;</span><br><span class="line">		<span class="keyword">if</span> (screen_ob) &#123;</span><br><span class="line">			SelectObject(screen_dc, screen_ob);</span><br><span class="line">			screen_ob = <span class="literal">NULL</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		DeleteDC(screen_dc);</span><br><span class="line">		screen_dc = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (screen_hb) &#123;</span><br><span class="line">		DeleteObject(screen_hb);</span><br><span class="line">		screen_hb = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (screen_handle) &#123;</span><br><span class="line">		CloseWindow(screen_handle);</span><br><span class="line">		screen_handle = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> LRESULT <span class="title">screen_events</span><span class="params">(HWND hWnd, UINT msg,</span></span></span><br><span class="line"><span class="function"><span class="params">	WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> (msg) &#123;</span><br><span class="line">	<span class="keyword">case</span> WM_CLOSE: screen_exit = <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_KEYDOWN: screen_keys[wParam &amp; <span class="number">511</span>] = <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_KEYUP: screen_keys[wParam &amp; <span class="number">511</span>] = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>: <span class="keyword">return</span> DefWindowProc(hWnd, msg, wParam, lParam);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">screen_dispatch</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	MSG msg;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!PeekMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, PM_NOREMOVE)) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">if</span> (!GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) <span class="keyword">break</span>;</span><br><span class="line">		DispatchMessage(&amp;msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">screen_update</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	HDC hDC = GetDC(screen_handle);</span><br><span class="line">	BitBlt(hDC, <span class="number">0</span>, <span class="number">0</span>, screen_w, screen_h, screen_dc, <span class="number">0</span>, <span class="number">0</span>, SRCCOPY);</span><br><span class="line">	ReleaseDC(screen_handle, hDC);</span><br><span class="line">	screen_dispatch();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="comment">// 主程序</span></span><br><span class="line"><span class="comment">//=====================================================================</span></span><br><span class="line"><span class="keyword">vertex_t</span> mesh[<span class="number">8</span>] = &#123;</span><br><span class="line">	&#123; &#123; <span class="number">-1</span>, <span class="number">-1</span>,  <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0</span>, <span class="number">0</span> &#125;, &#123; <span class="number">1.0f</span>, <span class="number">0.2f</span>, <span class="number">0.2f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123;  <span class="number">1</span>, <span class="number">-1</span>,  <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0.2f</span>, <span class="number">1.0f</span>, <span class="number">0.2f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123;  <span class="number">1</span>,  <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123; <span class="number">-1</span>,  <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1</span>, <span class="number">0</span> &#125;, &#123; <span class="number">1.0f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123; <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0</span>, <span class="number">0</span> &#125;, &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.2f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123;  <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0</span>, <span class="number">1</span> &#125;, &#123; <span class="number">0.2f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123;  <span class="number">1</span>,  <span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1.0f</span>, <span class="number">0.3f</span>, <span class="number">0.3f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">	&#123; &#123; <span class="number">-1</span>,  <span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1</span>, <span class="number">0</span> &#125;, &#123; <span class="number">0.2f</span>, <span class="number">1.0f</span>, <span class="number">0.3f</span> &#125;, <span class="number">1</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_plane</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">vertex_t</span> p1 = mesh[a], p2 = mesh[b], p3 = mesh[c], p4 = mesh[d];</span><br><span class="line">	p1.tc.u = <span class="number">0</span>, p1.tc.v = <span class="number">0</span>, p2.tc.u = <span class="number">0</span>, p2.tc.v = <span class="number">1</span>;</span><br><span class="line">	p3.tc.u = <span class="number">1</span>, p3.tc.v = <span class="number">1</span>, p4.tc.u = <span class="number">1</span>, p4.tc.v = <span class="number">0</span>;</span><br><span class="line">	device_draw_primitive(device, &amp;p1, &amp;p2, &amp;p3);</span><br><span class="line">	device_draw_primitive(device, &amp;p3, &amp;p4, &amp;p1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_box</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">float</span> theta)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">matrix_t</span> m;</span><br><span class="line">	matrix_set_rotate(&amp;m, <span class="number">-1</span>, <span class="number">-0.5</span>, <span class="number">1</span>, theta);</span><br><span class="line">	device-&gt;transform.world = m;</span><br><span class="line">	transform_update(&amp;device-&gt;transform);</span><br><span class="line">	draw_plane(device, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">	draw_plane(device, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line">	draw_plane(device, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">	draw_plane(device, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line">	draw_plane(device, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">3</span>);</span><br><span class="line">	draw_plane(device, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">camera_at_zero</span><span class="params">(<span class="keyword">device_t</span> *device, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">point_t</span> eye = &#123; x, y, z, <span class="number">1</span> &#125;, at = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> &#125;, up = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">	matrix_set_lookat(&amp;device-&gt;transform.view, &amp;eye, &amp;at, &amp;up);</span><br><span class="line">	transform_update(&amp;device-&gt;transform);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_texture</span><span class="params">(<span class="keyword">device_t</span> *device)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> IUINT32 texture[<span class="number">256</span>][<span class="number">256</span>];</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = i / <span class="number">32</span>, y = j / <span class="number">32</span>;</span><br><span class="line">			texture[j][i] = ((x + y) &amp; <span class="number">1</span>)? <span class="number">0xffffff</span> : <span class="number">0x3fbcef</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	device_set_texture(device, texture, <span class="number">256</span> * <span class="number">4</span>, <span class="number">256</span>, <span class="number">256</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">device_t</span> device;</span><br><span class="line">	<span class="keyword">int</span> states[] = &#123; RENDER_STATE_TEXTURE, RENDER_STATE_COLOR, RENDER_STATE_WIREFRAME &#125;;</span><br><span class="line">	<span class="keyword">int</span> indicator = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> kbhit = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">float</span> alpha = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">float</span> pos = <span class="number">3.5</span>;</span><br><span class="line"></span><br><span class="line">	TCHAR *title = _T(<span class="string">"Mini3d (software render tutorial) - "</span>)</span><br><span class="line">		_T(<span class="string">"Left/Right: rotation, Up/Down: forward/backward, Space: switch state"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (screen_init(<span class="number">800</span>, <span class="number">600</span>, title))</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	device_init(&amp;device, <span class="number">800</span>, <span class="number">600</span>, screen_fb);</span><br><span class="line">	camera_at_zero(&amp;device, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	init_texture(&amp;device);</span><br><span class="line">	device.render_state = RENDER_STATE_TEXTURE;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (screen_exit == <span class="number">0</span> &amp;&amp; screen_keys[VK_ESCAPE] == <span class="number">0</span>) &#123;</span><br><span class="line">		screen_dispatch();</span><br><span class="line">		device_clear(&amp;device, <span class="number">1</span>);</span><br><span class="line">		camera_at_zero(&amp;device, pos, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (screen_keys[VK_UP]) pos -= <span class="number">0.01f</span>;</span><br><span class="line">		<span class="keyword">if</span> (screen_keys[VK_DOWN]) pos += <span class="number">0.01f</span>;</span><br><span class="line">		<span class="keyword">if</span> (screen_keys[VK_LEFT]) alpha += <span class="number">0.01f</span>;</span><br><span class="line">		<span class="keyword">if</span> (screen_keys[VK_RIGHT]) alpha -= <span class="number">0.01f</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (screen_keys[VK_SPACE]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (kbhit == <span class="number">0</span>) &#123;</span><br><span class="line">				kbhit = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span> (++indicator &gt;= <span class="number">3</span>) indicator = <span class="number">0</span>;</span><br><span class="line">				device.render_state = states[indicator];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	<span class="keyword">else</span> &#123;</span><br><span class="line">			kbhit = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		draw_box(&amp;device, alpha);</span><br><span class="line">		screen_update();</span><br><span class="line">		Sleep(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E5%9B%BE%E5%BD%A2%E6%B8%B2%E6%9F%93/mini3d.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html" class="post-title-link" itemprop="url">sampler</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html" class="post-meta-item leancloud_visitors" data-flag-title="sampler" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sampler"><a href="#sampler" class="headerlink" title="sampler"></a>sampler</h1><hr>
<hr>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.khronos.org/opengl/wiki/Sampler_(GLSL" target="_blank" rel="noopener">Sampler_</a>)</li>
</ul>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/sampler.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html" class="post-title-link" itemprop="url">pipeline</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html" class="post-meta-item leancloud_visitors" data-flag-title="pipeline" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h1><hr>
<hr>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.opengl.org/img/uploads/pipeline/pipeline_001.pdf" target="_blank" rel="noopener">pipeline_001</a></li>
<li><a href="https://www.opengl.org/pipeline/" target="_blank" rel="noopener">pipeline</a></li>
</ul>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/pipeline/pipeline.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html" class="post-title-link" itemprop="url">derivativefunctions</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html" class="post-meta-item leancloud_visitors" data-flag-title="derivativefunctions" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="shader-derivative-functions-导数"><a href="#shader-derivative-functions-导数" class="headerlink" title="shader-derivative-functions 导数"></a>shader-derivative-functions 导数</h1><hr>
<hr>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.aclockworkberry.com/shader-derivative-functions/" target="_blank" rel="noopener">shader-derivative-functions</a></li>
<li><a href="https://www.opengl.org/pipeline/article/vol001_5" target="_blank" rel="noopener">Pipeline Newsletter</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/dFdx.xhtml" target="_blank" rel="noopener">dFdx</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL/extensions/ARB/ARB_derivative_control.txt" target="_blank" rel="noopener">ARB_derivative_control</a></li>
</ul>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/derivativefunctions.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html" class="post-title-link" itemprop="url">GLSL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html" class="post-meta-item leancloud_visitors" data-flag-title="GLSL" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="GLSL"><a href="#GLSL" class="headerlink" title="GLSL"></a>GLSL</h1><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.khronos.org/opengl/wiki/OpenGL_Shading_Language" target="_blank" rel="noopener">OpenGL_Shading_Language</a></li>
<li><a href="https://www.opengl.org/sdk/docs/tutorials/TyphoonLabs/" target="_blank" rel="noopener">TyphoonLabs</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL/specs/gl/" target="_blank" rel="noopener">specs</a></li>
<li><a href="https://www.khronos.org/opengl/wiki/Core_Language_(GLSL" target="_blank" rel="noopener">Core_Language</a>)</li>
</ul>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/GLSL/GLSL.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html" class="post-title-link" itemprop="url">绘制方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index"><span itemprop="name">OpenGL</span></a>
                </span>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html" class="post-meta-item leancloud_visitors" data-flag-title="绘制方式" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/opengl/opengl.jpg" alt>  </p>
<h1 id="立即模式-Immediate-Mode"><a href="#立即模式-Immediate-Mode" class="headerlink" title="立即模式(Immediate Mode)"></a>立即模式(Immediate Mode)</h1><hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">glBegin(GL_QUADS);</span><br><span class="line">&#123;</span><br><span class="line">  glColor4f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">-5</span>, <span class="number">-5</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">-5</span>, <span class="number">0</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">0.0</span>, <span class="number">-5</span>, <span class="number">0.0</span>);</span><br><span class="line">  glColor4f(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">5</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">  glVertex3f(<span class="number">0.0</span>, <span class="number">5</span>, <span class="number">0.0</span>);</span><br><span class="line">&#125;</span><br><span class="line">glEnd();</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="显示列表-DisplayList"><a href="#显示列表-DisplayList" class="headerlink" title="显示列表(DisplayList)"></a>显示列表(DisplayList)</h1><hr>
<p>初始化<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GLuint displayListId;</span><br><span class="line">displayListId = glGenLists(<span class="number">1</span>);</span><br><span class="line">glNewList(displayListId, GL_COMPILE);</span><br><span class="line">&#123;</span><br><span class="line">  glBegin(GL_QUADS);</span><br><span class="line">  &#123;</span><br><span class="line">    glColor4f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">-5</span>, <span class="number">-5</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">-5</span>, <span class="number">0</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0.0</span>, <span class="number">-5</span>, <span class="number">0.0</span>);</span><br><span class="line">    glColor4f(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">5</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    glVertex3f(<span class="number">0.0</span>, <span class="number">5</span>, <span class="number">0.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  glEnd();</span><br><span class="line">&#125;</span><br><span class="line">glEndList();</span><br></pre></td></tr></table></figure><p></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E7%BB%98%E5%88%B6%E6%96%B9%E5%BC%8F.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html" class="post-title-link" itemprop="url">图元类型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index"><span itemprop="name">OpenGL</span></a>
                </span>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html" class="post-meta-item leancloud_visitors" data-flag-title="图元类型" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/opengl/opengl.jpg" alt>  </p>
<h1 id="OPENGL2-1"><a href="#OPENGL2-1" class="headerlink" title="OPENGL2.1"></a>OPENGL2.1</h1><div class="table-container">
<table>
<thead>
<tr>
<th>图元</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>GL_POINTS</td>
<td>点</td>
</tr>
<tr>
<td>GL_LINES</td>
<td>线段</td>
</tr>
<tr>
<td>GL_LINE_STRIP</td>
<td>一个从第⼀个顶点依次经过每一个后续顶点而绘制的线条</td>
</tr>
<tr>
<td>GL_LINE_LOOP</td>
<td>和GL_LINE_STRIP相同,但是最后⼀个顶点和第⼀个顶点连接起来了了.</td>
</tr>
<tr>
<td>GL_TRIANGLES</td>
<td>每3个顶点定义⼀个新的三⻆角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_STRIP</td>
<td>共⽤⼀个条带(strip)上的顶点的⼀组三角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_FAN</td>
<td>以一个圆点为中⼼心呈扇形排列列,共⽤用相邻顶点的一组三⻆角形</td>
</tr>
<tr>
<td>GL_QUADS</td>
<td>四边形</td>
</tr>
<tr>
<td>GL_QUAD_STRIP</td>
<td>四边形</td>
</tr>
<tr>
<td>GL_POLYGON</td>
<td>单个简单填充凸多边形</td>
</tr>
</tbody>
</table>
</div>
<h1 id="OPENGL3-3"><a href="#OPENGL3-3" class="headerlink" title="OPENGL3.3"></a>OPENGL3.3</h1><div class="table-container">
<table>
<thead>
<tr>
<th>图元</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>GL_POINTS</td>
<td>点</td>
</tr>
<tr>
<td>GL_LINES</td>
<td>线段</td>
</tr>
<tr>
<td>GL_LINE_STRIP</td>
<td>一个从第⼀个顶点依次经过每一个后续顶点而绘制的线条</td>
</tr>
<tr>
<td>GL_LINE_LOOP</td>
<td>和GL_LINE_STRIP相同,但是最后⼀个顶点和第⼀个顶点连接起来了了.</td>
</tr>
<tr>
<td>GL_LINE_STRIP_ADJACENCY</td>
<td>新增</td>
</tr>
<tr>
<td>GL_LINES_ADJACENCY</td>
<td></td>
</tr>
<tr>
<td>GL_TRIANGLES</td>
<td>每3个顶点定义⼀个新的三⻆角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_STRIP</td>
<td>共⽤⼀个条带(strip)上的顶点的⼀组三角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_FAN</td>
<td>以一个圆点为中⼼心呈扇形排列列,共⽤用相邻顶点的一组三⻆角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_STRIP_ADJACENCY</td>
<td>新增</td>
</tr>
<tr>
<td>GL_TRIANGLE_ADJACENCY</td>
<td>新增</td>
</tr>
</tbody>
</table>
</div>
<h1 id="OPENGL4-5"><a href="#OPENGL4-5" class="headerlink" title="OPENGL4.5"></a>OPENGL4.5</h1><div class="table-container">
<table>
<thead>
<tr>
<th>图元</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>GL_POINTS</td>
<td>点</td>
</tr>
<tr>
<td>GL_LINES</td>
<td>线段</td>
</tr>
<tr>
<td>GL_LINE_STRIP</td>
<td>一个从第⼀个顶点依次经过每一个后续顶点而绘制的线条</td>
</tr>
<tr>
<td>GL_LINE_LOOP</td>
<td>和GL_LINE_STRIP相同,但是最后⼀个顶点和第⼀个顶点连接起来了了.</td>
</tr>
<tr>
<td>GL_LINE_STRIP_ADJACENCY</td>
<td></td>
</tr>
<tr>
<td>GL_LINES_ADJACENCY</td>
<td></td>
</tr>
<tr>
<td>GL_TRIANGLES</td>
<td>每3个顶点定义⼀个新的三⻆角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_STRIP</td>
<td>共⽤⼀个条带(strip)上的顶点的⼀组三角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_FAN</td>
<td>以一个圆点为中⼼心呈扇形排列列,共⽤用相邻顶点的一组三⻆角形</td>
</tr>
<tr>
<td>GL_TRIANGLE_STRIP_ADJACENCY</td>
<td></td>
</tr>
<tr>
<td>GL_TRIANGLE_ADJACENCY</td>
<td></td>
</tr>
<tr>
<td>GL_PATCHES</td>
<td>新增</td>
</tr>
</tbody>
</table>
</div>
<h1 id="GL-POINTS"><a href="#GL-POINTS" class="headerlink" title="GL_POINTS"></a>GL_POINTS</h1><h1 id="GL-LINES"><a href="#GL-LINES" class="headerlink" title="GL_LINES"></a>GL_LINES</h1><h1 id="GL-LINES-STRIP"><a href="#GL-LINES-STRIP" class="headerlink" title="GL_LINES_STRIP"></a>GL_LINES_STRIP</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E5%9B%BE%E5%85%83%E7%B1%BB%E5%9E%8B.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html" class="post-title-link" itemprop="url">三角化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenGL/" itemprop="url" rel="index"><span itemprop="name">OpenGL</span></a>
                </span>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html" class="post-meta-item leancloud_visitors" data-flag-title="三角化" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="GL-QUADS-四边形三角化"><a href="#GL-QUADS-四边形三角化" class="headerlink" title="GL_QUADS 四边形三角化"></a>GL_QUADS 四边形三角化</h1><h1 id="GL-POLYGON-多边形三角化"><a href="#GL-POLYGON-多边形三角化" class="headerlink" title="GL_POLYGON 多边形三角化"></a>GL_POLYGON 多边形三角化</h1><h1 id="画圆"><a href="#画圆" class="headerlink" title="画圆"></a>画圆</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Base/%E4%B8%89%E8%A7%92%E5%8C%96.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html" class="post-title-link" itemprop="url">Interpolation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html" class="post-meta-item leancloud_visitors" data-flag-title="Interpolation" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://en.wikipedia.org/wiki/Interpolation_(computer_graphics" target="_blank" rel="noopener">Interpolation</a>)  </p>

          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/Animation/Interpolation.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://leeeyupeng.github.io/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon128.jpg">
      <meta itemprop="name" content="leeyupeng">
      <meta itemprop="description" content="leeyupeng@126.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="leeyupeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html" class="post-title-link" itemprop="url">ubo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 12:31:14" itemprop="dateCreated datePublished" datetime="2020-07-15T12:31:14+08:00">2020-07-15</time>
            </span>

          
            <span id="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html" class="post-meta-item leancloud_visitors" data-flag-title="ubo" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Uniform-Buffer-Object"><a href="#Uniform-Buffer-Object" class="headerlink" title="Uniform Buffer Object"></a>Uniform Buffer Object</h1><hr>
<p>//vert1.vs<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">layout (location = <span class="number">0</span>) in vec3 aPos;</span><br><span class="line"></span><br><span class="line">uniform mat4 model;</span><br><span class="line"></span><br><span class="line">layout (std140) uniform Matrices</span><br><span class="line">&#123;</span><br><span class="line">   mat4 projection;</span><br><span class="line">   mat4 view;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   gl_Position = projection * view * model * vec4(aPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<p>//vert2.vs<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">layout (location = <span class="number">0</span>) in vec3 aPos;</span><br><span class="line"></span><br><span class="line">layout (std140) uniform Matrices</span><br><span class="line">&#123;</span><br><span class="line">   mat4 projection;</span><br><span class="line">   mat4 view;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uniform mat4 model;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   gl_Position = projection * view * model * vec4(aPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uniformBlockBinding &lt; GL_MAX_UNIFORM_BUFFER_BINDINGS</span></span><br><span class="line">uniformBlockBindingID = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//创建buffer</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uboMatrices;</span><br><span class="line">glGenBuffers(<span class="number">1</span>, &amp;uboMatrices);</span><br><span class="line">glBindBuffer(GL_UNIFORM_BUFFER, uboMatrices);</span><br><span class="line">glBufferData(GL_UNIFORM_BUFFER, <span class="number">2</span> * <span class="keyword">sizeof</span>(glm::mat4), <span class="literal">NULL</span>, GL_STATIC_DRAW);</span><br><span class="line">glBindBuffer(GL_UNIFORM_BUFFER, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// define the range of the buffer that links to a uniform binding point</span></span><br><span class="line">glBindBufferRange(GL_UNIFORM_BUFFER, uniformBlockBindingID, uboMatrices, <span class="number">0</span>, <span class="number">2</span> * <span class="keyword">sizeof</span>(glm::mat4));</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取uboindex,并uboindex绑定uniformBlockBinding</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uniformBlockIndex1 = glGetUniformBlockIndex(program1, <span class="string">"Matrices"</span>);</span><br><span class="line">glUniformBlockBinding(program1, uniformBlockIndex1, uniformBlockBindingID);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取uboindex,并uboindex绑定uniformBlockBinding</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uniformBlockIndex2 = glGetUniformBlockIndex(program2, <span class="string">"Matrices"</span>);</span><br><span class="line">glUniformBlockBinding(program2, uniformBlockIndex2, uniformBlockBindingID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the projection matrix (we only do this once now) (note: we're not using zoom anymore by changing the FoV)</span></span><br><span class="line">glm::mat4 projection = glm::perspective(<span class="number">45.0f</span>, (<span class="keyword">float</span>)SCR_WIDTH  / (<span class="keyword">float</span>)SCR_HEIGHT, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">glBindBuffer(GL_UNIFORM_BUFFER, uboMatrices);</span><br><span class="line">glBufferSubData(GL_UNIFORM_BUFFER, <span class="number">0</span>, <span class="keyword">sizeof</span>(glm::mat4), glm::value_ptr(projection));</span><br></pre></td></tr></table></figure>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/OpenGL/buffer%20object/ubo.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="leeyupeng"
      src="/images/icon128.jpg">
  <p class="site-author-name" itemprop="name">leeyupeng</p>
  <div class="site-description" itemprop="description">leeyupeng@126.com</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">434</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">157</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/about" title="QQ → about"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:leeyupeng@126.com" title="E-Mail → mailto:leeyupeng@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">leeyupeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wbbpG5Yxg8WKIQmzEeNU9P5G-gzGzoHsz","app_key":"y271idcAENCbz0foGfiEtWOu","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('/js/src/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'wbbpG5Yxg8WKIQmzEeNU9P5G-gzGzoHsz',
      appKey     : 'y271idcAENCbz0foGfiEtWOu',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
